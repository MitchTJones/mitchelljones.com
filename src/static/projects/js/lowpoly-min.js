var winSize,center,nodeRows,nodeCols,topLeft,topRight,botLeft,botRight,nodeDist=100,variancePct=.75,overflow=3,prefs=[],gradColors=[];initGradColors(prefs=""===location.hash?["blue","white","black","white","red"]:location.hash.split("#")[1].split("+"));var cvs,ctx,gradMovement=!0,nodeMovement=!0,max_wander_offset=.3,max_wander_radius=5,wander_theta=Math.random()*(2*Math.PI),wander_radius=Math.random()*max_wander_radius,Wanderer=function(){function t(t,i,e,s){this.x=t,this.y=i,this.v=new Vector(t,i),this.wander=e,this.origin={x:t,y:i},s&&!(this.x<0||this.y<0||this.x>winSize.x||this.y>winSize.y)?this.moves=!0:this.moves=!1,this.wandered=0,this.wander_theta=0,this.wander_radius=0,this.max_wander_offset=5,this.max_wander_radius=1e3,this.wander_theta=Math.random()*(2*Math.PI),this.wander_radius=Math.random()*max_wander_radius}return t.prototype.move=function(){this.moves&&(this.wander_offset=Math.random()*(2*max_wander_offset)-max_wander_offset,this.wander_theta+=this.wander_offset,this.dX=Math.cos(this.wander_theta)/30,this.dY=Math.sin(this.wander_theta)/30,this.nX=this.x+this.dX,diff(this.nX,this.origin.x)>this.wander&&(this.dX=-this.dX),diff(this.nY,this.origin.y)>this.wander&&(this.dY=-this.dY),this.x+=this.dX,this.y+=this.dY,this.v.set(this.x,this.y))},t}(),Circulator=function(){function t(t,i,e,s){this.center=new Vector(t,i),this.radius=e,this.x=0,this.y=0,this.v=new Vector(this.x,this.y),this.angle=s}return t.prototype.move=function(){this.x=this.center.x+Math.cos(this.angle)*this.radius,this.y=this.center.y+Math.sin(this.angle)*this.radius,this.v=new Vector(this.x,this.y),this.angle+=Math.PI/5e3},t.prototype.display=function(){cEllipse(this.v,5,"#000000")},t}(),rectMover=function(){function t(t,i,e,s,o){this.min=t,this.max=i,this.speed=e,this.moves=o,this.v=new Vector(0,0),0==s?this.v.set(t.x,t.y):1==s?this.v.set(i.x,t.y):2==s?this.v.set(i.x,i.y):3==s&&this.v.set(t.x,i.y),this.vel=new Vector(0,0),this.v.y==t.y?this.vel.set(this.speed,0):this.vel.set(-this.speed,0)}return t.prototype.move=function(){this.moves&&(this.v.x>this.max.x&&(this.v.x=this.max.x,this.vel.set(0,this.speed)),this.v.y>this.max.y&&(this.v.y=this.max.y,this.vel.set(-this.speed,0)),this.v.x<this.min.x&&(this.v.x=this.min.x,this.vel.set(0,-this.speed)),this.v.y<this.min.y&&(this.v.y=this.min.y,this.vel.set(this.speed,0)),this.v.add(this.vel),this.x=this.v.x,this.y=this.v.y)},t.prototype.display=function(){cEllipse(this.v,5,"#000000")},t}(),Triangle=function(){function t(t,i,e){this.l1=t,this.l2=i,this.l3=e,this.c=vectorAverage(this.l1,this.l2,this.l3),this.color,this.sum=this.c.x+this.c.y}return t.prototype.display=function(){cTriangle(this.l1,this.l2,this.l3,this.color)},t}(),nodes=[],tris=[],gradVectors=[];function setup(t,i){cvs=t,ctx=i,initialize()}function initialize(){winSize=getWinSize(),center=winSize.div(2);dist(new Vector(0,0),center);gradVectors[0]=new rectMover(new Vector(0,0),winSize,.33,0,gradMovement),gradVectors[1]=new rectMover(new Vector(0,0),winSize,.33,2,gradMovement),nodeRows=Math.floor(winSize.y/nodeDist)+1,nodeCols=Math.floor(winSize.x/nodeDist)+1;var t=winSize.y/(nodeRows-1),i=winSize.x/(nodeCols-1);for(nodes=[],r=0;r<nodeRows+overflow;r++)for(nodes.push([]),c=0;c<nodeCols+overflow;c++){var e=variancePct*nodeDist;nodes[r].push(new Wanderer((c-overflow/2)*i+(Math.random()*e-e/2),(r-overflow/2)*t+(Math.random()*e-e/2),.5,nodeMovement))}topLeft=nodes[0][0].v,topRight=nodes[0][nodeCols-1].v,botLeft=nodes[nodeRows-1][0].v,botRight=nodes[nodeRows-1][nodeCols-1].v,triinitialize()}function draw(){for(r=0;r<nodes.length;r++)for(c=0;c<nodes[r].length;c++)nodes[r][c].move();for(t=0;t<tris.length;t++)tris[t].display();for(i=0;i<gradVectors.length;i++)gradVectors[i].move();triColors()}function triinitialize(){for(tris=[],r=0;r<nodes.length;r++)for(c=0;c<nodes[r].length;c++)r>=nodes.length-1||c>=nodes[r].length-1||r<=0||c<=0||(tris.push(new Triangle(nodes[r][c],nodes[r-1][c],nodes[r][c-1])),tris.push(new Triangle(nodes[r][c],nodes[r+1][c],nodes[r][c+1])));triColors()}function triColors(){for(t=0;t<tris.length;t++)tris[t].color=rgbToHex(gradients(gradColors,viDegree(gradVectors[0].v,gradVectors[1].v,tris[t].c)))}function initGradColors(t){for(gradColors=[],i=0;i<t.length;i++){t[i].includes("#")?gradColors.push(t[i]):void 0!==colors[t[i]]&&gradColors.push(colors[t[i]])}}function changeColors(t){initGradColors(t)}function changeNodeMovement(t){for(nodeMovement=t,x=0;x<nodes.length;x++)for(y=0;y<nodes[x].length;y++)nodes[x][y].moves=nodeMovement}function changeGradMovement(t){for(gradMovement=t,i=0;i<gradVectors.length;i++)gradVectors[i].moves=gradMovement}function changeVariance(t){variancePct=t,initialize()}function changeNodeDist(t){nodeDist=t,initialize()}init("canvas",setup,draw);