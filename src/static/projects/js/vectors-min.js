var nodeAmount,nodeRows,nodeCols,cvs,ctx,mouseLoc=new Vector,tool=0,PULL=0,PUSH=1,TWIST=2,frozen=!1,holeSize=30,holeGRate=-.25,holeG=!0,nodes=[],holes=[],resetting=!1;function setup(e,s){cvs=e,ctx=s,initialize()}function draw(){for(isReset&&(isReset=!1,onClick_reset()),i=0;i<nodes.length;i++)nodes[i].tick(),frozen||nodes[i].move(),(nodes[i].loc.x+nodes[i].radius>cvs.width||nodes[i].loc.x-nodes[i].radius<0)&&nodes[i].shiftSpeed(-1,1),(nodes[i].loc.y+nodes[i].radius>cvs.height||nodes[i].loc.y-nodes[i].radius<0)&&nodes[i].shiftSpeed(1,-1);for(i=0;i<holes.length;i++){for(holes[i].tick(),n=0;n<nodes.length;n++)if(tool==TWIST)nodes[n].speed.add(twist(nodes[n].loc,holes[i].loc,5*holes[i].radius/sq(dist(nodes[n].loc,holes[i].loc))));else{var e=1;tool==PUSH?e=1:tool==PULL&&(e=-1),nodes[n].speed.add(grav(nodes[n].loc,holes[i].loc,5*holes[i].radius/sq(dist(nodes[n].loc,holes[i].loc))).times(e))}holeG&&(holes[i].radius>Math.abs(holeGRate)?holes[i].grow(holeGRate):holes.splice(i,1))}}function initialize(){for(nodeCols=Math.floor(cvs.width/60),nodeRows=Math.floor(cvs.height/53),r=0;r<nodeRows;r++)for(c=0;c<nodeCols;c++)nodes.push(new Node((c+1)*cvs.width/(nodeCols+1),(r+1)*cvs.height/(nodeRows+1),10,getRandomColor()))}function onClick_reset(){nodes=[],initialize()}function reset(){scaleCanvas(getWinSize()),setup(),onClick_reset()}function grav(e,s,o){var t=dist(e,s),i=xDist(e,s),n=yDist(e,s),d=Math.abs(i)/i*Math.sqrt(1-sq(n/Math.sqrt(sq(i)+sq(n)))),l=Math.abs(n)/n*Math.sqrt(1-sq(i/Math.sqrt(sq(i)+sq(n)))),c=new Vector(d,l);return t>10?c=c.times(o):c.set(0,0),c}function twist(e,s,o){var t=dist(e,s),i=xDist(e,s),n=-yDist(e,s),d=Math.abs(i)/i*Math.sqrt(1-sq(n/Math.sqrt(sq(i)+sq(n)))),l=Math.abs(n)/n*Math.sqrt(1-sq(i/Math.sqrt(sq(i)+sq(n)))),c=new Vector(l,d);return t>10?c=c.times(o):c.set(0,0),c}init("canvas",setup,draw),window.addEventListener("click",function(e){var s=cvs.getBoundingClientRect();mouseLoc.set(e.clientX-s.left,e.clientY-s.top),hovering||frozen||holes.push(new Node(mouseLoc.x,mouseLoc.y,holeSize,"#20094C"))}),window.addEventListener("mousemove",function(e){var s=cvs.getBoundingClientRect();mouseLoc.set(e.clientX-s.left,e.clientY-s.top)}),$(window).resize(function(){reset()}),document.addEventListener("keydown",function(e){32==e.keyCode?resetting=!resetting:39==e.keyCode&&alert("Right was pressed")});